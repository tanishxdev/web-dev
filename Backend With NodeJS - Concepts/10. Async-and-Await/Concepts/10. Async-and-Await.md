# Topic 10 Async / Await

---

### **Concept**

**What is Async / Await in Node.js?**

* **Async/Await** is **syntactic sugar** built on top of **Promises**.
* It allows you to write **asynchronous code in a synchronous style**, making it easier to read, write, and debug.
* Introduced in **ES2017**, it’s now the most preferred way to handle asynchronous logic in Node.js.

---

### **Why Async / Await?**

| Problem (with Promises)                            | Solution (with Async/Await)                         |
| -------------------------------------------------- | --------------------------------------------------- |
| Chained `.then()` blocks become long               | Write code that looks like normal sequential logic  |
| Hard to handle try-catch with multiple async steps | Use single `try...catch` block for error handling   |
| Difficult to debug                                 | Simple line-by-line flow just like synchronous code |

---

### **How Async / Await Works**

1. An **`async` function** always returns a **Promise**.
2. Inside an async function, the **`await`** keyword pauses execution until the Promise is resolved or rejected.
3. Use **`try...catch`** for clean error handling.
4. The rest of your code keeps running (non-blocking).

---

### **Folder Setup**

```
async-await-demo/
│
└── app.js
```

---

### **Code Example 1: Basic Async / Await Example**

**File:** `app.js`

```js
// ===========================
// Example: Basic Async / Await
// ===========================

// Function that returns a Promise
function delay(ms) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(`Waited for ${ms / 1000} seconds`);
    }, ms);
  });
}

// Async function that uses await
async function runTask() {
  console.log("Task started...");

  const msg1 = await delay(1000);
  console.log(msg1);

  const msg2 = await delay(2000);
  console.log(msg2);

  console.log("Task completed!");
}

runTask();
```

**Output Example:**

```
Task started...
Waited for 1 seconds
Waited for 2 seconds
Task completed!
```

---

### **Code Example 2: Error Handling with try...catch**

**File:** `error-example.js`

```js
// ===========================
// Example: Error Handling in Async / Await
// ===========================

// A function returning a rejected Promise
function riskyOperation() {
  return new Promise((resolve, reject) => {
    const success = Math.random() > 0.5;
    setTimeout(() => {
      if (success) resolve("Operation successful!");
      else reject("Operation failed!");
    }, 1000);
  });
}

async function execute() {
  try {
    const result = await riskyOperation();
    console.log(result);
  } catch (error) {
    console.log("Error:", error);
  } finally {
    console.log("Execution finished.");
  }
}

execute();
```

**Output Example:**

```
Operation successful!
Execution finished.

-- or --
Error: Operation failed!
Execution finished.
```

---

### **Code Example 3: Async / Await with fs.promises**

**File:** `file-demo.js`

```js
// ===========================
// Example: Async/Await with fs.promises
// ===========================

const fs = require('fs').promises;

async function fileWorkflow() {
  try {
    // Write to file
    await fs.writeFile('./data/async.txt', 'Learning async/await in Node.js');
    console.log("File created.");

    // Read file
    const content = await fs.readFile('./data/async.txt', 'utf8');
    console.log("File Content:", content);

    // Append data
    await fs.appendFile('./data/async.txt', '\nAsync/Await makes life easier!');
    console.log("Data appended.");

    // Read updated file
    const updated = await fs.readFile('./data/async.txt', 'utf8');
    console.log("Updated Content:\n", updated);

    // Delete file
    await fs.unlink('./data/async.txt');
    console.log("File deleted successfully.");

  } catch (err) {
    console.log("Error:", err.message);
  }
}

fileWorkflow();
```

**Output Example:**

```
File created.
File Content: Learning async/await in Node.js
Data appended.
Updated Content:
Learning async/await in Node.js
Async/Await makes life easier!
File deleted successfully.
```

---

### **Mini Project: Fetch User Data Simulation**

**Goal:** Simulate multiple asynchronous API calls using async/await.

**Folder:**

```
async-project/
│
└── app.js
```

**File:** `app.js`

```js
// ===========================
// Mini Project: Async User Data Simulation
// ===========================

// Simulate fetching user data
function getUser() {
  return new Promise((resolve) => {
    setTimeout(() => resolve({ id: 1, name: 'Tanish' }), 1000);
  });
}

// Simulate fetching user posts
function getPosts(userId) {
  return new Promise((resolve) => {
    setTimeout(() => resolve([
      { id: 101, title: 'Learning Node.js' },
      { id: 102, title: 'Understanding Async/Await' },
    ]), 1500);
  });
}

// Simulate fetching comments
function getComments(postId) {
  return new Promise((resolve) => {
    setTimeout(() => resolve([
      { id: 1, text: 'Great post!' },
      { id: 2, text: 'Very helpful.' },
    ]), 1000);
  });
}

async function displayUserData() {
  try {
    console.log("Fetching user...");
    const user = await getUser();
    console.log("User:", user);

    console.log("Fetching posts...");
    const posts = await getPosts(user.id);
    console.log("Posts:", posts);

    console.log("Fetching comments for first post...");
    const comments = await getComments(posts[0].id);
    console.log("Comments on first post:", comments);

    console.log("All data fetched successfully.");
  } catch (error) {
    console.log("Error:", error.message);
  }
}

displayUserData();
```

**Output Example:**

```
Fetching user...
User: { id: 1, name: 'Tanish' }
Fetching posts...
Posts: [
  { id: 101, title: 'Learning Node.js' },
  { id: 102, title: 'Understanding Async/Await' }
]
Fetching comments for first post...
Comments on first post: [
  { id: 1, text: 'Great post!' },
  { id: 2, text: 'Very helpful.' }
]
All data fetched successfully.
```

---

### **Dependencies**

* No external dependencies — uses only **built-in Promises**.

---

### **Notes**

* Async/Await makes code **look synchronous but run asynchronously**.
* Always use **try/catch** for handling errors cleanly.
* You can run multiple async tasks in parallel using `Promise.all()`.
* Async/Await internally uses Promises — it’s just **syntactic sugar** over them.

---