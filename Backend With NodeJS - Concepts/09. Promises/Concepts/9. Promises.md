
# Topic 9 Promises

---
![](https://tutorial.techaltum.com/images/javascript-promise.jpg)

### **Concept**

**What are Promises in Node.js?**

* A **Promise** is an **object that represents the eventual completion (or failure)** of an asynchronous operation and its resulting value.
* It provides a **cleaner alternative to callbacks**, making asynchronous code **easier to read and manage**.

---

### **Why Promises?**

| Problem (with callbacks)         | Solution (with Promises)                        |
| -------------------------------- | ----------------------------------------------- |
| Nested “callback hell” code      | Flat, chainable structure using `.then()`       |
| Hard to handle errors            | Centralized `.catch()` error handling           |
| Difficult to maintain async flow | Readable async chaining and async/await support |

---

### **How Promises Work**

A Promise has **3 states**:

1. **Pending** → The operation is still running.
2. **Resolved (Fulfilled)** → The operation completed successfully.
3. **Rejected** → The operation failed.

You attach callbacks using:

* `.then()` → handles success
* `.catch()` → handles errors
* `.finally()` → runs regardless of result

---

### **Folder Setup**

```
promises-demo/
│
└── app.js
```

---

### **Code Example 1: Creating and Using a Promise**

**File:** `app.js`

```js
// ===========================
// Example: Simple Promise
// ===========================

// Create a Promise
const task = new Promise((resolve, reject) => {
  const isDone = true;

  if (isDone) {
    resolve("Task completed successfully!");
  } else {
    reject("Task failed!");
  }
});

// Consume the Promise
task
  .then((message) => {
    console.log("Success:", message);
  })
  .catch((error) => {
    console.log("Error:", error);
  })
  .finally(() => {
    console.log("Promise execution finished.");
  });
```

**Output Example:**

```
Success: Task completed successfully!
Promise execution finished.
```

---

### **Code Example 2: Promisifying Asynchronous Tasks**

Let’s convert a callback-based function (`fs.readFile`) into a **Promise-based** one.

**File:** `app.js` (updated)

```js
// ===========================
// Example: Promisifying fs.readFile
// ===========================

const fs = require('fs');

// Function that returns a Promise
function readFilePromise(filePath) {
  return new Promise((resolve, reject) => {
    fs.readFile(filePath, 'utf8', (err, data) => {
      if (err) reject(err);
      else resolve(data);
    });
  });
}

// Use the promise
readFilePromise('./data/info.txt')
  .then((data) => {
    console.log("File Content:\n", data);
  })
  .catch((err) => {
    console.log("Error:", err.message);
  });
```

**Output Example:**

```
File Content:
Hello from the Promise-based file reader!
```

---

### **Code Example 3: Promise Chaining**

**File:** `chain.js`

```js
// ===========================
// Example: Promise Chaining
// ===========================

function step1() {
  return new Promise((resolve) => {
    console.log("Step 1: Starting task...");
    setTimeout(() => resolve("Step 1 completed"), 1000);
  });
}

function step2() {
  return new Promise((resolve) => {
    console.log("Step 2: Processing data...");
    setTimeout(() => resolve("Step 2 completed"), 1000);
  });
}

function step3() {
  return new Promise((resolve) => {
    console.log("Step 3: Finishing up...");
    setTimeout(() => resolve("Step 3 completed"), 1000);
  });
}

// Chain promises
step1()
  .then((msg1) => {
    console.log(msg1);
    return step2();
  })
  .then((msg2) => {
    console.log(msg2);
    return step3();
  })
  .then((msg3) => {
    console.log(msg3);
    console.log("All steps completed successfully!");
  })
  .catch((err) => console.log("Error:", err));
```

**Output Example:**

```
Step 1: Starting task...
Step 1 completed
Step 2: Processing data...
Step 2 completed
Step 3: Finishing up...
Step 3 completed
All steps completed successfully!
```

---

### **Mini Project: Promise-based File Workflow**

**Goal:** Use Promises to write, read, and delete files cleanly.

**Folder:**

```
promises-project/
│
├── app.js
└── data/
```

**File:** `app.js`

```js
// ===========================
// Mini Project: File Operations with Promises
// ===========================

const fs = require('fs').promises; // Use built-in fs.promises

async function manageFiles() {
  try {
    // 1. Write a file
    await fs.writeFile('./data/promise-demo.txt', 'Learning Promises in Node.js');
    console.log('File written successfully.');

    // 2. Read the file
    const data = await fs.readFile('./data/promise-demo.txt', 'utf8');
    console.log('File Content:', data);

    // 3. Append more data
    await fs.appendFile('./data/promise-demo.txt', '\nPromises make async easy!');
    console.log('Data appended.');

    // 4. Read again
    const updated = await fs.readFile('./data/promise-demo.txt', 'utf8');
    console.log('Updated Content:\n', updated);

    // 5. Delete file
    await fs.unlink('./data/promise-demo.txt');
    console.log('File deleted successfully.');

  } catch (err) {
    console.log('Error:', err.message);
  } finally {
    console.log('Operation completed.');
  }
}

manageFiles();
```

**Run in terminal:**

```bash
node app.js
```

**Output Example:**

```
File written successfully.
File Content: Learning Promises in Node.js
Data appended.
Updated Content:
Learning Promises in Node.js
Promises make async easy!
File deleted successfully.
Operation completed.
```

---

### **Dependencies**

* No external dependencies — uses built-in `fs.promises`.

---

### **Notes**

* Promises improve readability over callbacks.
* Always **return** a Promise inside `.then()` to chain correctly.
* Use `Promise.all()` to run multiple async tasks in parallel.
* Promises are the foundation of **`async/await`**, which provides even cleaner syntax.

---
