# Topic 11 Event Emitter

---
![EventEmitter](https://miro.medium.com/1*V_P2MpfuksGDwn9k6i1LOQ.png)
### **Concept**


**What is EventEmitter in Node.js?**

* The **EventEmitter** is part of Node.js’s **`events` module**, which provides a mechanism to **emit and listen for custom events**.
* Node.js architecture is **event-driven**, meaning it heavily relies on **events and callbacks** (like `request`, `data`, `close`, etc.) for asynchronous operations.
* You can use it to **build custom event systems**, **decouple logic**, and **handle real-time updates**.

---

### **Why EventEmitter?**

| Need                         | Explanation                                                                      |
| ---------------------------- | -------------------------------------------------------------------------------- |
| **Event-driven programming** | Handle asynchronous actions by triggering and responding to events.              |
| **Custom Events**            | Build your own “emitters” for app logic like notifications or data updates.      |
| **Decoupled Communication**  | Allows modules to communicate without directly calling each other.               |
| **Core Foundation**          | Core Node features like `http`, `fs`, and `streams` use EventEmitter internally. |

---

### **How It Works**

1. Import `EventEmitter` class from `events` module.
2. Create an instance of it.
3. Register a **listener** using `.on('eventName', callback)`.
4. Emit the event using `.emit('eventName', data)`.
5. The listener is triggered automatically when the event is emitted.

---

### **Folder Setup**

```
event-demo/
│
└── app.js
```

---

### **Code Example 1: Basic EventEmitter**

**File:** `app.js`

```js
// ===========================
// Example: Basic EventEmitter
// ===========================

const EventEmitter = require('events');

// Create an instance of EventEmitter
const emitter = new EventEmitter();

// Register an event listener
emitter.on('greet', (name) => {
  console.log(`Hello, ${name}! Welcome to EventEmitter.`);
});

// Emit the event
emitter.emit('greet', 'Tanish');
```

**Output:**

```
Hello, Tanish! Welcome to EventEmitter.
```

---

### **Code Example 2: Multiple Listeners**

**File:** `app.js` (updated)

```js
// ===========================
// Example: Multiple Listeners
// ===========================

const EventEmitter = require('events');
const emitter = new EventEmitter();

// Listener 1
emitter.on('status', () => {
  console.log("Server started successfully...");
});

// Listener 2
emitter.on('status', () => {
  console.log("Database connected...");
});

// Emit event
emitter.emit('status');
```

**Output:**

```
Server started successfully...
Database connected...
```

> Note: Multiple listeners for the same event execute **in order of registration**.

---

### **Code Example 3: Passing Data and Removing Listeners**

**File:** `app.js` (continued)

```js
// ===========================
// Example: Pass Data and Remove Listener
// ===========================

const EventEmitter = require('events');
const emitter = new EventEmitter();

// Define listener function
const notifyUser = (user, msg) => {
  console.log(`Notification for ${user}: ${msg}`);
};

// Register listener
emitter.on('notify', notifyUser);

// Emit events
emitter.emit('notify', 'Tanish', 'You have a new message.');
emitter.emit('notify', 'Arjun', 'Your upload completed.');

// Remove listener
emitter.removeListener('notify', notifyUser);

// Try emitting again (won’t trigger since removed)
emitter.emit('notify', 'Tanish', 'This will not be logged.');
```

**Output:**

```
Notification for Tanish: You have a new message.
Notification for Arjun: Your upload completed.
```

---

### **Code Example 4: Extending EventEmitter (Real-world Use)**

In real-world apps, you’ll often **extend** EventEmitter to create custom classes that can emit events.

**File:** `user.js`

```js
// ===========================
// Custom Class extending EventEmitter
// ===========================

const EventEmitter = require('events');

class User extends EventEmitter {
  login(username) {
    console.log(`${username} logged in.`);
    this.emit('login', username);
  }

  logout(username) {
    console.log(`${username} logged out.`);
    this.emit('logout', username);
  }
}

module.exports = User;
```

**File:** `app.js`

```js
// ===========================
// Example: Using Custom Event Class
// ===========================

const User = require('./user');

// Create user instance
const user = new User();

// Listen for login and logout events
user.on('login', (name) => console.log(`Welcome, ${name}!`));
user.on('logout', (name) => console.log(`Goodbye, ${name}!`));

// Trigger events
user.login('Tanish');
user.logout('Tanish');
```

**Output:**

```
Tanish logged in.
Welcome, Tanish!
Tanish logged out.
Goodbye, Tanish!
```

---

### **Mini Project: Event-based Logger System**

**Goal:** Create a simple logger using custom events.

**Folder:**

```
event-logger/
│
├── logger.js
└── app.js
```

**File:** `logger.js`

```js
// ===========================
// Custom Event-based Logger
// ===========================

const EventEmitter = require('events');
const fs = require('fs');
const path = require('path');

class Logger extends EventEmitter {
  log(message) {
    // Emit custom 'log' event
    this.emit('log', message);
  }
}

const logger = new Logger();

// Listener to write log to file
logger.on('log', (msg) => {
  const logPath = path.join(__dirname, 'app.log');
  const time = new Date().toISOString();
  fs.appendFileSync(logPath, `[${time}] ${msg}\n`);
  console.log('Logged:', msg);
});

module.exports = logger;
```

**File:** `app.js`

```js
// ===========================
// Mini Project: Logger in Action
// ===========================

const logger = require('./logger');

// Emit log events
logger.log("Server started...");
logger.log("User logged in: Tanish");
logger.log("Database connection successful.");
```

**Run in terminal:**

```bash
node app.js
```

**Output in console:**

```
Logged: Server started...
Logged: User logged in: Tanish
Logged: Database connection successful.
```

**File (`app.log`) content:**

```
[2025-11-08T15:24:56.000Z] Server started...
[2025-11-08T15:24:56.001Z] User logged in: Tanish
[2025-11-08T15:24:56.002Z] Database connection successful.
```

---

### **Dependencies**

* No external dependencies — uses built-in `events`, `fs`, and `path` modules.

---

### **Notes**

* `EventEmitter` is central to Node.js’s **non-blocking architecture**.
* Use `.on()` to attach listeners and `.emit()` to trigger events.
* Use `.once()` to listen for an event only **once**.
* Always remove unnecessary listeners (`.removeListener()` or `.off()`) to prevent **memory leaks**.
* Real-world examples:

  * `http.Server` emits `request` and `close` events.
  * Streams emit `data`, `end`, and `error` events.

---