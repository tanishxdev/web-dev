# Topic 27 Buffers in Node.js

---

### **Concept**

**What is a Buffer?**

* A **Buffer** is a temporary memory area used to handle **binary data** directly in Node.js.
* It is useful when working with:

  * File System (reading/writing files)
  * Network streams (HTTP/TCP sockets)
  * Binary formats (images, videos, PDFs)
  * Encoding conversions (base64, hex)

Why? Because **JavaScript strings are not binary-safe**, but Node.js needs a way to process raw bytes.
Buffers allow us to work with raw memory directly.

---

### **Why Use Buffers?**

| Need / Scenario                 | Why Buffer Helps                                       |
| ------------------------------- | ------------------------------------------------------ |
| Reading a file as raw bytes     | Buffers store binary data efficiently                  |
| Network packet data processing  | Data arrives in chunks (streams)                       |
| Converting between encodings    | Buffers support multiple encodings (utf8, base64, hex) |
| Manipulating images/audio/video | Binary data representation                             |

---

### **Create Buffers**

#### 1. Allocate empty buffer

```js
const buf = Buffer.alloc(10); // 10 bytes filled with zeros
console.log(buf);
```

#### 2. Allocate uninitialized (faster, but contains old memory data)

```js
const buf = Buffer.allocUnsafe(10);
console.log(buf);
```

#### 3. Create from string

```js
const buf = Buffer.from("Hello");
console.log(buf);          // <Buffer 48 65 6c 6c 6f>
console.log(buf.toString()); // Hello
```

---

### **Buffer Properties**

```js
const buf = Buffer.from("Node");
console.log(buf.length); // 4 bytes
```

---

### **Buffer Encodings**

| Encoding | Usage                      |
| -------- | -------------------------- |
| `utf8`   | Default string encoding    |
| `hex`    | Used in cryptography       |
| `base64` | Used in image/file sharing |
| `binary` | Raw binary form            |

Example:

```js
const buf = Buffer.from("Hello World");
console.log(buf.toString("base64"));  // SGVsbG8gV29ybGQ=
```

---

### **Read and Write to Buffer**

```js
const buf = Buffer.alloc(5);
buf.write("Hello");
console.log(buf.toString()); // Hello
```

Slice and modify:

```js
const buf = Buffer.from("ABCDEFG");
const slice = buf.slice(0, 4);
console.log(slice.toString()); // ABCD
```

---

### **Compare Buffers**

```js
const a = Buffer.from("abc");
const b = Buffer.from("abd");

console.log(Buffer.compare(a, b)); // -1 (a < b)
```

---

### **Concatenate Buffers**

```js
const b1 = Buffer.from("Hello ");
const b2 = Buffer.from("World");
const result = Buffer.concat([b1, b2]);
console.log(result.toString()); // Hello World
```

---

### **Buffer to JSON**

```js
const buf = Buffer.from("Hi");
console.log(buf.toJSON());
```

Output:

```json
{ "type": "Buffer", "data": [ 72, 105 ] }
```

---

## Buffer with File System (Very Important)

### Read file as Buffer

```js
const fs = require("fs");

const data = fs.readFileSync("test.png");
console.log("Buffer length:", data.length);
```

### Write Buffer to file

```js
const fs = require("fs");

const buf = Buffer.from("Hello Node");
fs.writeFileSync("output.txt", buf);
```

---

## Mini Project: Convert Image to Base64 and Back

**Folder:**

```
image-buffer/
│
├── encode.js
└── decode.js
```

---

### encode.js (Image → Base64)

```js
const fs = require("fs");

const img = fs.readFileSync("photo.png");
const base64 = img.toString("base64");

fs.writeFileSync("encoded.txt", base64);
console.log("Image encoded to encoded.txt");
```

Run:

```bash
node encode.js
```

---

### decode.js (Base64 → Image)

```js
const fs = require("fs");

const base64 = fs.readFileSync("encoded.txt", "utf8");
const buffer = Buffer.from(base64, "base64");

fs.writeFileSync("decoded.png", buffer);
console.log("Image decoded to decoded.png");
```

---

## Notes

* Buffers are fixed size and represent raw memory.
* Streams use buffers internally. Buffers allow chunk processing.
* Large buffers should be freed when done to avoid memory leaks.
* Prefer `Buffer.alloc()` instead of `Buffer.allocUnsafe()` for security.

---

### Quick Summary Table

| Operation          | Method                        |
| ------------------ | ----------------------------- |
| Create new Buffer  | `Buffer.alloc(size)`          |
| Create from string | `Buffer.from(str)`            |
| Convert to string  | `buf.toString()`              |
| Write data         | `buf.write()`                 |
| Concatenate        | `Buffer.concat([buf1, buf2])` |
| Compare            | `Buffer.compare(buf1, buf2)`  |

---\