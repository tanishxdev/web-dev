# Topic 12 Express.js

---

### **Concept**

**What is Express.js?**

* **Express.js** is a **fast, minimal, and flexible web framework** built on top of Node.js.
* It simplifies creating servers, routing, and handling HTTP requests/responses.
* Built on the **HTTP module**, it provides a cleaner, high-level API to build **REST APIs and web applications**.

---

### **Why Express.js?**

| Problem (with raw HTTP)  | Solution (with Express)                    |
| ------------------------ | ------------------------------------------ |
| Manual route handling    | `app.get('/route', fn)` makes it simple    |
| Complex response headers | Express handles content type, status codes |
| Code repetition          | Middleware functions reuse logic           |
| Hard file serving        | Built-in static file handling              |
| No router separation     | Express Router enables modular structure   |

---

### **How Express Works**

1. Import the Express module.
2. Create an app using `express()`.
3. Define routes (`GET`, `POST`, etc.).
4. Listen on a specific port.
5. Optionally use middleware for logging, parsing, authentication, etc.

---

### **Folder Setup**

```
express-demo/
│
├── app.js
└── package.json
```

---

### **Step 1: Install Express**

```bash
npm init -y
npm install express
```

---

### **Code Example 1: Basic Express Server**

**File:** `app.js`

```js
// ===========================
// Example: Basic Express Server
// ===========================

const express = require('express');
const app = express();

// Define a route
app.get('/', (req, res) => {
  res.send('Hello from Express.js Server!');
});

// Start the server
app.listen(3000, () => {
  console.log('Server running at http://localhost:3000');
});
```

**Run in terminal:**

```bash
node app.js
```

**Output:**

```
Server running at http://localhost:3000
```

Visit:
`http://localhost:3000` → “Hello from Express.js Server!”

---

### **Code Example 2: Handling Multiple Routes**

```js
// ===========================
// Example: Multiple Routes
// ===========================

const express = require('express');
const app = express();

app.get('/', (req, res) => res.send('Home Page'));
app.get('/about', (req, res) => res.send('About Us Page'));
app.get('/contact', (req, res) => res.send('Contact Page'));

// 404 route (should always be last)
app.use((req, res) => {
  res.status(404).send('404 Page Not Found');
});

app.listen(4000, () => console.log('Server running on port 4000'));
```

**Visit:**

* `/` → Home Page
* `/about` → About Us
* `/contact` → Contact
* `/xyz` → 404 Page Not Found

---

### **Code Example 3: Using Middleware**

Middleware = functions that run **before route handlers** to process requests.

```js
// ===========================
// Example: Custom Middleware
// ===========================

const express = require('express');
const app = express();

// Custom middleware for logging
app.use((req, res, next) => {
  console.log(`${req.method} ${req.url}`);
  next(); // Move to next handler
});

app.get('/', (req, res) => res.send('Middleware example in Express'));
app.get('/test', (req, res) => res.send('Check console for logs'));

app.listen(5000, () => console.log('Server running on port 5000'));
```

**Output Example:**

```
GET /
GET /test
```

---

### **Code Example 4: Handling POST Requests**

**Enable JSON body parsing** using built-in middleware: `express.json()`.

```js
// ===========================
// Example: Handling POST Requests
// ===========================

const express = require('express');
const app = express();

// Middleware to parse JSON
app.use(express.json());

app.post('/api/user', (req, res) => {
  const user = req.body;
  console.log('Received User:', user);
  res.status(201).send({ message: 'User created', data: user });
});

app.listen(6000, () => console.log('Server running on port 6000'));
```

**Test with Postman:**

```json
POST http://localhost:6000/api/user
Body (JSON):
{
  "name": "Tanish",
  "age": 22
}
```

**Response:**

```json
{
  "message": "User created",
  "data": { "name": "Tanish", "age": 22 }
}
```

---

### **Code Example 5: Express Router (Modular Routes)**

**Folder:**

```
express-router/
│
├── app.js
└── routes/
    └── userRoutes.js
```

**File:** `routes/userRoutes.js`

```js
// ===========================
// Router Example
// ===========================

const express = require('express');
const router = express.Router();

router.get('/', (req, res) => res.send('All Users'));
router.post('/', (req, res) => res.send('Create New User'));
router.get('/:id', (req, res) => res.send(`Get user with ID: ${req.params.id}`));

module.exports = router;
```

**File:** `app.js`

```js
const express = require('express');
const userRoutes = require('./routes/userRoutes');
const app = express();

// Middleware
app.use(express.json());

// Mount router
app.use('/users', userRoutes);

app.listen(7000, () => console.log('Server running on port 7000'));
```

**Test Routes:**

* `GET /users` → All Users
* `POST /users` → Create New User
* `GET /users/2` → Get user with ID: 2

---

### **Mini Project: Simple Express API**

**Goal:** Create a mini REST API for managing products.

**Folder:**

```
express-api/
│
├── app.js
└── products.json
```

**File:** `app.js`

```js
// ===========================
// Mini Project: Simple Express API
// ===========================

const express = require('express');
const app = express();
app.use(express.json());

let products = [
  { id: 1, name: 'Keyboard', price: 500 },
  { id: 2, name: 'Mouse', price: 300 },
];

// Get all products
app.get('/api/products', (req, res) => {
  res.send(products);
});

// Get single product
app.get('/api/products/:id', (req, res) => {
  const product = products.find(p => p.id === parseInt(req.params.id));
  if (!product) return res.status(404).send('Product not found.');
  res.send(product);
});

// Add new product
app.post('/api/products', (req, res) => {
  const newProduct = { id: products.length + 1, ...req.body };
  products.push(newProduct);
  res.status(201).send(newProduct);
});

// Delete product
app.delete('/api/products/:id', (req, res) => {
  products = products.filter(p => p.id !== parseInt(req.params.id));
  res.send({ message: 'Product deleted' });
});

// Start server
app.listen(8000, () => console.log('Server running on http://localhost:8000'));
```

**Test API Endpoints:**
✅ `GET /api/products`
✅ `GET /api/products/1`
✅ `POST /api/products`
✅ `DELETE /api/products/2`

---

### **Dependencies**

| Package           | Purpose                                     |
| ----------------- | ------------------------------------------- |
| **express**       | Framework for routing and handling requests |
| **nodemon (dev)** | Auto restarts server during development     |

---

### **Notes**

* Express simplifies `http` by abstracting low-level details.
* Use `app.use()` for global middleware and `express.Router()` for modular routes.
* Express supports **static files**, **JSON parsing**, and **template engines (like EJS)**.
* For larger apps, follow MVC structure:

  * `/routes` → route definitions
  * `/controllers` → logic functions
  * `/models` → database logic

---
